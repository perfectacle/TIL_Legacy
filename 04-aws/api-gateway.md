---
title: API 게이트웨이
---

# API 게이트웨이
API 관문, API 서버로 다이렉트로 찌르면 누구나 다 접근이 가능하니
인가된 사용자만 통과할 수 있게 해주는 문지기 같은 역할.  
하지만 게이트웨이를 찌르지 않고 뒷단에 있는 API 서버를 다이렉트로 찔렀을 때가 문제  
또한 API 서버가 물리적으로 존재하는 단순한 하나의 서버가 아닌 다른 서비스(elb나 빈스톡 등등을 물려놨을 때)  
어떻게 컨트롤 해야할지 난감하다.  
아래는 어떻게 해결해야할지 고민과 삽질(해결은 못함 ㅠㅠ)을 해둔 상태이다.  

1. 빈스톡을 external에서 internal로 바꾸고 lambda에서 vpc 내에 존재하는 빈스톡을 호출(api 게이트웨이 -> 람다 -> 빈스톡 -> EC2)  
이 방법은 api가 추가될 때마다 lambda에도 추가를 해줘야하는 번거로움...  
2. 게이트웨이에서 제공해주는 인증서를 통해서 client-certificate-auth을 사용하기. (api 게이트웨이 -> 빈스톡(api 게이트웨이에서 보낸 인증서를 가지고 통신했는지 검증) -> ec2)  
이 방법을 사용하면 빈스톡에 있는 nginx 설정도 건드려야하고 nginx에 게이트웨이에서 제공한 인증서 외에 서버측 ssl 인증서를 물려야하나?란 의문이 있는 상태입니다. 설정하기도 뭔가 삽질이 많이 필요해보이고...  
3. 네트워크 로드 밸런서 사용(api 게이트웨이 -> NLB -> VPC 내의 EC2)  
얘는 빈스톡을 바라보는 게 아니라 EC2 인스턴스를 바라보는 것이기 때문에 오토 스케일링 등등에 능동적으로 대응을 하기 어렵다는 문제도 있어보이고...  
4. api 게이트웨이를 걷어내고 어플리케이션 서버 단에서 처리

아... 답이 없다 ㅠㅠ